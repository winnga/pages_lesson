---
title: "GAPMINDER | GDP PER CAPITA 2007"  
format: dashboard   
---

```{python}
import pandas as pd
import plotly.express as px
import itables 


# Load the data
gap = px.data.gapminder()

# Filter for year 2007
gap_07 = gap.query("year == 2007")

# Compute highest life expectancy
highest_row = gap_07.sort_values("gdpPercap", ascending=False).head(1).squeeze()
highest_life_exp_country = highest_row["country"]
highest_life_exp_value = round(highest_row["gdpPercap"], 1)

# Compute lowest life expectancy
lowest_row = gap_07.sort_values("gdpPercap", ascending=True).head(1).squeeze()
lowest_life_exp_country = lowest_row["country"]
lowest_life_exp_value = round(lowest_row["gdpPercap"], 1)

# Compute average (population-weighted) life expectancy
weighted_mean = (gap_07["gdpPercap"] * gap_07["pop"]).sum() / gap_07["pop"].sum()
average_life_exp_value = round(weighted_mean, 1)

# Create the map using plotly express with a blue color scale
map_fig = px.choropleth(
    gap_07,
    locations="iso_alpha",
    color="gdpPercap",
    hover_name="country",
    title="Map of Countries by GDP Per Capita",
    color_continuous_scale="Blues",
).update_layout(coloraxis_showscale=False)

# Largest 20 countries by Life Expectancy (bar chart) with a blue color scale
top_20 = gap_07.nlargest(10, "pop").sort_values("gdpPercap", ascending=True)
bar_fig = px.bar(
    top_20,
    x="gdpPercap",
    y="country",
    title="GDP per capita in 10 Largest Countries",
    color="gdpPercap",
    color_continuous_scale="Blues",
).update_layout(coloraxis_showscale=False)

```

# HOME

## Row 1 {height=30%}

::: {.valuebox icon="arrow-up" color="#1E90FF" title="Highest Per Capita GDP"}

`{python} str(highest_life_exp_value)`

`{python} highest_life_exp_country`

:::

::: {.valuebox icon="arrow-down" color="#87CEFA" title="Lowest Per Capita GDP"} 

`{python} str(lowest_life_exp_value)`

`{python} lowest_life_exp_country`

:::

::: {.valuebox icon="graph-up" color="#4682B4" title="Average Per Capita GDP"}

`{python} str(average_life_exp_value)`

:::

## Row 2 {height=60%}

### {width=70%}

```{python}
map_fig
```

### {width=40%}

```{python}
bar_fig
```

# REGIONAL

## Row 1 {height=30%}

```{python}
# Create regional summary
reg_sum = (
    gap_07.groupby("continent")
    .apply(
        lambda g: pd.Series(
            {
                "Average Per Capita GDP": g["gdpPercap"].mean(),
                "Lowest Per Capita GDP": g["gdpPercap"].min(),
                "Country with Lowest Per Capita GDP": g.loc[g["lifeExp"].idxmin(), "country"],
                "Highest Per Capita GDP": g["gdpPercap"].max(),
                "Country with Highest Per Capita GDP": g.loc[
                    g["gdpPercap"].idxmax(), "country"
                ],
            }
        )
    )
    .round(2)
)

itables.show(reg_sum)
```

## Row 2 {height=70%}

### Column {width="80%"}

```{python}
continent_fig = px.box(
    gap_07,
    x="continent",
    y="gdpPercap",
    color="continent",
    title="Distribution of Per Capita GDP by Continent",
    points="all",  # This shows all data points
    hover_data=["country"],  # This adds country names to hover info
    color_discrete_sequence=px.colors.sequential.Turbo,  # Built-in Blues palette
).update_layout(
    showlegend=False, xaxis_title="Continent", yaxis_title="Per Capita GDP (USD per person)"
)

continent_fig
```

### Column {width="20%"}

Africa shows markedly lower life expectancy figures compared to other continents, reflecting significant developmental challenges.

Europe and Oceania demonstrate the most consistently high life expectancies, while Asia and the Americas show greater variability, indicating diverse development stages within these regions.

# DATA DOWNLOAD

```{python}
# Display full dataset with itables
itables.show(gap_07, caption="Gapminder Dataset (2007)", buttons=["csvHtml5"])
```


# ABOUT

This data comes from the python `plotly.express` library’s `gapminder` dataset, which is originally sourced from the Gapminder Foundation.

The Gapminder Foundation is a non-profit venture that promotes sustainable global development and achievement of the United Nations Millennium Development Goals by increasing use and understanding of statistics and other information about social, economic, and environmental development.

**Watch Hans Rosling’s TED Talk:**

<iframe width="560" height="315" src="https://www.youtube.com/embed/hVimVzgtD6w?si=dKHepC5EXhjaXOe2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
